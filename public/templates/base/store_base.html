{% extends "base/app.html" %}

{% block title %}Store - Food Stores{% endblock %}

{% block nav_menu %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('customer.index') }}">首頁</a>
    </li>
    {% if session.user_id %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('customer.orders') }}">我的訂單</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('customer.profile') }}">個人資料</a>
    </li>
    {% endif %}
{% endblock %}

{% block user_info %}
    {% if session.user_id %}
        <span class="navbar-text me-3">歡迎，{{ session.user_name }}</span>
        <a href="{{ url_for('customer.cart') }}" class="btn btn-outline-primary btn-sm me-2 position-relative">
            <i class="bi bi-cart3"></i> 購物車
            <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                0
            </span>
        </a>
        <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-secondary btn-sm">登出</a>
    {% else %}
        <a href="{{ url_for('customer.login') }}" class="btn btn-outline-primary btn-sm me-2">登入</a>
        <a href="{{ url_for('customer.register') }}" class="btn btn-primary btn-sm">註冊</a>
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
// 更新購物車數量
function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const cartCountEl = $('#cartCount');
    if (cartCountEl.length) {
        const count = cart.length;
        cartCountEl.text(count);
        cartCountEl.toggle(count > 0);
    }
}

// 頁面載入時更新購物車數量
$(document).ready(function() {
    updateCartCount();
});

// 監聽購物車變化
window.addEventListener('storage', function(e) {
    if (e.key === 'cart') {
        updateCartCount();
    }
});
</script>
{% endblock %}

